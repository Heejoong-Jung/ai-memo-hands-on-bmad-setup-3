# Story 1.1: 이메일/비밀번호 회원가입

## Status

Draft

---

## Story

**As a** 신규 사용자,  
**I want** 이메일과 비밀번호로 회원가입을 할 수 있기를,  
**so that** AI 메모장 서비스를 사용하여 내 메모를 안전하게 관리할 수 있다.

---

## Acceptance Criteria

1. 이메일 형식 유효성 검증이 작동한다
2. 비밀번호 강도 요구사항(최소 8자, 영문/숫자 조합)이 적용된다
3. 중복된 이메일로 가입 시 명확한 에러 메시지를 표시한다
4. 회원가입 성공 시 자동으로 로그인되고 메인 페이지로 이동한다
5. 이메일 확인(verification) 메일이 발송된다
6. 회원가입 폼은 모바일/데스크탑 모두에서 정상 작동한다
7. 회원가입 진행 중 로딩 상태를 명확히 표시한다

---

## Tasks / Subtasks

- [ ] Task 1: Supabase Auth 설정 및 연동 (AC: 1, 2, 3, 4, 5)
  - [ ] Supabase 프로젝트에서 Email Auth 활성화 확인
  - [ ] 환경 변수 설정 (NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY)
  - [ ] Supabase 클라이언트 유틸리티 함수 작성 (`lib/supabase/client.ts`)
  - [ ] Supabase 서버 컴포넌트용 클라이언트 작성 (`lib/supabase/server.ts`)

- [ ] Task 2: 회원가입 UI 컴포넌트 구현 (AC: 1, 2, 3, 6, 7)
  - [ ] 회원가입 페이지 라우트 생성 (`app/auth/signup/page.tsx`)
  - [ ] shadcn/ui Form, Input, Button 컴포넌트 설치
  - [ ] 이메일 입력 필드 with 유효성 검증 UI
  - [ ] 비밀번호 입력 필드 with 강도 표시
  - [ ] 비밀번호 확인 입력 필드
  - [ ] 제출 버튼 및 로딩 상태 표시
  - [ ] 에러 메시지 표시 영역
  - [ ] Tailwind를 사용한 반응형 레이아웃 구현

- [ ] Task 3: 회원가입 Server Action 구현 (AC: 1, 2, 3, 4, 5, 7)
  - [ ] Server Action 파일 생성 (`app/auth/actions.ts`)
  - [ ] `signUp` 함수 구현
    - [ ] 이메일 형식 검증 로직
    - [ ] 비밀번호 강도 검증 로직 (최소 8자, 영문+숫자)
    - [ ] Supabase Auth `signUp` API 호출
    - [ ] 성공 시 세션 생성 및 리다이렉트
    - [ ] 실패 시 명확한 에러 메시지 반환
  - [ ] 에러 핸들링 및 로깅

- [ ] Task 4: 클라이언트 사이드 폼 로직 구현 (AC: 1, 2, 3, 6, 7)
  - [ ] React Hook Form 또는 Next.js form 액션 연동
  - [ ] 실시간 유효성 검증 (이메일, 비밀번호 강도)
  - [ ] 비밀번호 일치 확인
  - [ ] 제출 시 로딩 상태 관리
  - [ ] 에러 상태 UI 업데이트
  - [ ] 성공 시 리다이렉션 처리

- [ ] Task 5: 테스트 작성
  - [ ] 이메일 유효성 검증 단위 테스트
  - [ ] 비밀번호 강도 검증 단위 테스트
  - [ ] 회원가입 Server Action 통합 테스트
  - [ ] UI 컴포넌트 렌더링 테스트
  - [ ] 에러 케이스 테스트 (중복 이메일, 약한 비밀번호)

---

## Dev Notes

### 기술 스택 및 아키텍처 컨텍스트

**프레임워크 및 라우팅**
- Next.js App Router 사용 (`/app` 디렉토리 구조)
- Server Actions로 서버 로직 구현
[Source: docs/architecture.md#1-기술-스택]

**인증 시스템**
- Supabase Auth 사용
- 이메일/비밀번호 기반 인증
- 세션 관리 및 자동 갱신은 Supabase가 처리
[Source: docs/architecture.md#1-기술-스택, docs/prd.md#6-mvp-scope]

**UI 컴포넌트 및 스타일링**
- shadcn/ui 컴포넌트 라이브러리 사용 (Form, Input, Button 등)
- Tailwind CSS로 스타일링
- Radix UI 기반 접근성 지원
[Source: docs/architecture.md#1-기술-스택]

**보안 및 권한**
- 클라이언트에서 직접 외부 API 호출 금지 (서버사이드에서만)
- Supabase 서비스 롤 키는 서버 전용
- 사용자 스코프 권한 제어는 서버 코드에서 처리
[Source: docs/architecture.md#3-보안]

**데이터 모델**
- 사용자 정보는 Supabase Auth의 `auth.users` 테이블에 저장
- 추가 프로필 정보가 필요할 경우 별도 테이블 생성 가능
[Source: docs/architecture.md#2-데이터-모델]

### 파일 위치 및 구조

**예상 파일 생성 위치:**
- `/app/auth/signup/page.tsx` - 회원가입 페이지
- `/app/auth/actions.ts` - 인증 관련 Server Actions
- `/lib/supabase/client.ts` - Supabase 클라이언트 (브라우저용)
- `/lib/supabase/server.ts` - Supabase 클라이언트 (서버 컴포넌트용)
- `/lib/validations/auth.ts` - 인증 관련 유효성 검증 함수

### 구현 가이드라인

**이메일 유효성 검증:**
- 표준 이메일 정규식 사용
- 실시간 피드백 제공

**비밀번호 요구사항:**
- 최소 8자
- 영문자 + 숫자 조합 필수
- 특수문자 권장 (선택)

**에러 처리:**
- 중복 이메일: "이미 사용 중인 이메일입니다"
- 약한 비밀번호: "비밀번호는 최소 8자, 영문과 숫자를 포함해야 합니다"
- 네트워크 에러: "회원가입 중 오류가 발생했습니다. 다시 시도해주세요"

**UX 고려사항:**
- 로딩 중 버튼 비활성화 및 스피너 표시
- 성공 시 즉시 메인 페이지(`/`)로 리다이렉트
- 이메일 확인 안내 메시지 표시 (선택적)

### Testing

**단위 테스트:**
- 유효성 검증 함수 테스트 (`lib/validations/auth.ts`)
- 각 검증 케이스별 테스트 (유효한 이메일, 무효한 이메일, 비밀번호 강도 등)

**통합 테스트:**
- Server Action `signUp` 함수 테스트
- 성공 케이스: 정상 회원가입 → 세션 생성 확인
- 실패 케이스: 중복 이메일, 약한 비밀번호 → 적절한 에러 반환

**컴포넌트 테스트:**
- 회원가입 폼 렌더링 테스트
- 사용자 입력 시뮬레이션 및 유효성 검증 UI 업데이트 확인
- 제출 후 로딩 상태 및 에러 메시지 표시 확인

**테스트 프레임워크:**
- Jest 또는 Vitest 사용 권장
- React Testing Library for 컴포넌트 테스트

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-13 | 1.0 | 스토리 1.1 초안 생성 | Bob (Scrum Master) |

---

## Dev Agent Record

### Agent Model Used

_[Dev Agent가 작성]_

### Debug Log References

_[Dev Agent가 작성]_

### Completion Notes List

_[Dev Agent가 작성]_

### File List

_[Dev Agent가 작성]_

---

## QA Results

_[QA Agent가 작성]_

