# Story 1.2: 이메일/비밀번호 로그인

## Status

Ready for Review

---

## Story

**As a** 기존 사용자,  
**I want** 이메일과 비밀번호로 로그인을 할 수 있기를,  
**so that** 내 계정에 접근하여 저장된 메모를 관리하고 AI 기능을 사용할 수 있다.

---

## Acceptance Criteria

1. 이메일 형식 유효성 검증이 작동한다
2. 로그인 실패 시 명확한 에러 메시지를 표시한다 (잘못된 이메일/비밀번호)
3. 로그인 성공 시 메인 페이지로 자동 리다이렉트된다
4. 세션이 생성되고 브라우저에 안전하게 저장된다
5. 로그인 폼은 모바일/데스크탑 모두에서 정상 작동한다
6. 로그인 진행 중 로딩 상태를 명확히 표시한다
7. 회원가입 페이지로 이동할 수 있는 링크가 제공된다
8. "비밀번호 찾기" 링크가 표시된다 (향후 구현 준비)

---

## Tasks / Subtasks

- [x] Task 1: 로그인 UI 컴포넌트 구현 (AC: 1, 2, 5, 6, 7, 8)
  - [x] 로그인 페이지 라우트 생성 (`app/auth/login/page.tsx`)
  - [x] shadcn/ui Form, Input, Button 컴포넌트 재사용 (스토리 1.1에서 이미 설치됨)
  - [x] 이메일 입력 필드 with 유효성 검증 UI
  - [x] 비밀번호 입력 필드
  - [x] 로그인 버튼 및 로딩 상태 표시
  - [x] 에러 메시지 표시 영역
  - [x] 회원가입 링크 추가 (`/auth/signup`으로 이동)
  - [x] 비밀번호 찾기 링크 추가 (플레이스홀더, 향후 기능)
  - [x] Tailwind를 사용한 반응형 레이아웃 구현

- [x] Task 2: 로그인 Server Action 구현 (AC: 1, 2, 3, 4, 6)
  - [x] `app/auth/actions.ts`에 `signIn` 함수 추가
  - [x] 이메일 형식 검증 (스토리 1.1의 유효성 검증 함수 재사용)
  - [x] Supabase Auth `signInWithPassword` API 호출
  - [x] 성공 시 세션 생성 및 메인 페이지(`/`)로 리다이렉트
  - [x] 실패 시 명확한 에러 메시지 반환
    - 잘못된 이메일/비밀번호: "이메일 또는 비밀번호가 올바르지 않습니다"
    - 네트워크 에러: "로그인 중 오류가 발생했습니다. 다시 시도해주세요"
  - [x] 에러 핸들링 및 로깅

- [x] Task 3: 클라이언트 사이드 폼 로직 구현 (AC: 1, 2, 5, 6)
  - [x] React Hook Form 또는 Next.js form 액션 연동
  - [x] 실시간 이메일 형식 검증
  - [x] 제출 시 로딩 상태 관리 (버튼 비활성화, 스피너 표시)
  - [x] 에러 상태 UI 업데이트
  - [x] 성공 시 리다이렉션 처리

- [x] Task 4: 테스트 작성
  - [x] 이메일 유효성 검증 단위 테스트 (스토리 1.1에서 이미 작성됨, 재사용 확인)
  - [x] 로그인 Server Action 통합 테스트
    - 성공 케이스: 올바른 이메일/비밀번호 → 세션 생성
    - 실패 케이스: 잘못된 이메일/비밀번호 → 에러 반환
  - [x] UI 컴포넌트 렌더링 테스트
    - 로그인 폼 렌더링
    - 회원가입 링크 존재 확인
    - 비밀번호 찾기 링크 존재 확인
  - [x] 사용자 입력 시뮬레이션 테스트
  - [x] 로딩 상태 및 에러 메시지 표시 확인

---

## Dev Notes

### 기술 스택 및 아키텍처 컨텍스트

**프레임워크 및 라우팅**
- Next.js App Router 사용 (`/app` 디렉토리 구조)
- Server Actions로 서버 로직 구현
[Source: docs/architecture.md#1-기술-스택]

**인증 시스템**
- Supabase Auth 사용
- 이메일/비밀번호 기반 인증
- 세션 관리 및 자동 갱신은 Supabase가 처리
- Supabase Auth API: `signInWithPassword` 메서드 사용
[Source: docs/architecture.md#1-기술-스택, docs/prd.md#6-mvp-scope]

**UI 컴포넌트 및 스타일링**
- shadcn/ui 컴포넌트 라이브러리 사용 (Form, Input, Button, Card 등)
- Tailwind CSS로 스타일링
- Radix UI 기반 접근성 지원
[Source: docs/architecture.md#1-기술-스택]

**보안 및 권한**
- 세션은 Supabase가 자동으로 관리 (쿠키 기반)
- 클라이언트에서 직접 외부 API 호출 금지 (서버사이드에서만)
- Supabase 서비스 롤 키는 서버 전용
[Source: docs/architecture.md#3-보안]

**데이터 모델**
- 사용자 정보는 Supabase Auth의 `auth.users` 테이블에 저장
- 로그인 시 세션 정보가 자동으로 생성됨
[Source: docs/architecture.md#2-데이터-모델]

### 이전 스토리(1.1)에서의 주요 인사이트

- Supabase 클라이언트 및 서버 유틸리티 함수 이미 구현됨:
  - `lib/supabase/client.ts` (브라우저용)
  - `lib/supabase/server.ts` (서버용)
- 이메일 유효성 검증 함수 재사용 가능: `lib/validations/auth.ts`의 `validateEmail` 함수
- shadcn/ui 컴포넌트 이미 설치됨: Button, Input, Label, Card
- Vitest + React Testing Library 테스트 환경 설정 완료
- 환경 변수 설정 완료 (`.env.local`)

### 파일 위치 및 구조

**예상 파일 생성 위치:**
- `/app/auth/login/page.tsx` - 로그인 페이지 (새로 생성)
- `/app/auth/actions.ts` - `signIn` 함수 추가 (기존 파일 수정)

**재사용 가능한 파일:**
- `/lib/supabase/client.ts` - Supabase 클라이언트
- `/lib/supabase/server.ts` - Supabase 서버 클라이언트
- `/lib/validations/auth.ts` - 이메일 유효성 검증 함수
- `/components/ui/*` - 모든 UI 컴포넌트

### 구현 가이드라인

**이메일 유효성 검증:**
- 스토리 1.1에서 구현한 `validateEmail` 함수 재사용
- 실시간 피드백 제공

**로그인 에러 처리:**
- 잘못된 이메일/비밀번호: "이메일 또는 비밀번호가 올바르지 않습니다"
- 이메일 미인증: "이메일 인증이 필요합니다. 이메일을 확인해주세요" (Supabase 설정에 따라)
- 네트워크 에러: "로그인 중 오류가 발생했습니다. 다시 시도해주세요"

**UX 고려사항:**
- 로딩 중 버튼 비활성화 및 스피너 표시
- 성공 시 즉시 메인 페이지(`/`)로 리다이렉트
- 회원가입 링크 명확히 표시: "계정이 없으신가요? 회원가입"
- 비밀번호 찾기 링크 표시 (플레이스홀더, 향후 스토리 1.3에서 구현)

**Supabase API 사용법:**
```typescript
// 로그인 예시
const { data, error } = await supabase.auth.signInWithPassword({
  email: 'user@example.com',
  password: 'password123'
})

if (error) {
  // 에러 처리
}

if (data.session) {
  // 세션 생성 성공
}
```

### Testing

**단위 테스트:**
- 이메일 유효성 검증 함수 테스트 (스토리 1.1에서 이미 작성, 재사용 확인)
- 새로운 테스트 불필요 (기존 테스트 커버리지 확인만 필요)

**통합 테스트:**
- Server Action `signIn` 함수 테스트
- 성공 케이스: 올바른 이메일/비밀번호 → 세션 생성 확인
- 실패 케이스: 잘못된 이메일/비밀번호 → 적절한 에러 반환
- Supabase Auth API 모킹 필요

**컴포넌트 테스트:**
- 로그인 폼 렌더링 테스트
- 이메일/비밀번호 입력 필드 존재 확인
- 로그인 버튼 존재 확인
- 회원가입 링크 존재 및 올바른 경로(`/auth/signup`) 확인
- 비밀번호 찾기 링크 존재 확인
- 사용자 입력 시뮬레이션 및 유효성 검증 UI 업데이트 확인
- 제출 후 로딩 상태 및 에러 메시지 표시 확인

**테스트 프레임워크:**
- Vitest (이미 설정됨)
- React Testing Library (이미 설정됨)
- Supabase Auth API 모킹을 위해 `vi.mock` 사용

**테스트 파일 위치:**
- `app/auth/login/page.test.tsx` - 로그인 페이지 컴포넌트 테스트
- `app/auth/actions.test.ts` - signIn Server Action 테스트 (새로 생성)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | 스토리 1.2 초안 생성 | Bob (Scrum Master) |
| 2025-10-14 | 2.0 | 스토리 1.2 구현 완료 - 로그인 기능 구현 및 테스트 통과 | James (Dev Agent) |

---

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5

### Debug Log References

N/A - 모든 테스트 통과, 디버그 로그 불필요

### Completion Notes List

- ✅ 로그인 페이지 UI 구현 완료 (`app/auth/login/page.tsx`)
- ✅ Server Action `signIn` 함수 구현 완료 (`app/auth/actions.ts`)
- ✅ 실시간 이메일 유효성 검증 구현 완료
- ✅ 로딩 상태 및 에러 핸들링 구현 완료
- ✅ 회원가입/비밀번호 찾기 링크 추가 완료
- ✅ 반응형 레이아웃 구현 완료 (모바일/데스크탑)
- ✅ 포괄적인 단위/통합 테스트 작성 완료
- ✅ 모든 테스트 통과 (20/20 tests passed)
- ✅ Acceptance Criteria 1-8 모두 충족

### File List

**신규 생성:**
- `app/auth/login/page.tsx` - 로그인 페이지 컴포넌트
- `app/auth/login/page.test.tsx` - 로그인 페이지 테스트
- `app/auth/actions.test.ts` - Server Actions 테스트

**수정:**
- `app/auth/actions.ts` - `signIn` 함수 및 `SignInResult` 타입 추가

**재사용 (변경 없음):**
- `lib/validations/auth.ts` - 이메일 유효성 검증 함수
- `lib/supabase/server.ts` - Supabase 서버 클라이언트
- `components/ui/*` - shadcn/ui 컴포넌트들

---

## QA Results

_[QA Agent가 작성]_

