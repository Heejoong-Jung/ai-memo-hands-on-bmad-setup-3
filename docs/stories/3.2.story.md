# Story 3.2: ì‹¤ì‹œê°„ ìŒì„±-í…ìŠ¤íŠ¸ ë³€í™˜

## Status

Draft

---

## Story

**As a** ì‚¬ìš©ì,  
**I want** ìŒì„±ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ì—¬ ë…¸íŠ¸ì— ì…ë ¥í•  ìˆ˜ ìˆì–´,  
**so that** ë¹ ë¥´ê³  í¸ë¦¬í•˜ê²Œ ìŒì„± ê¸°ë°˜ ë©”ëª¨ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

---

## Acceptance Criteria

1. ìŒì„± ì¸ì‹ ì‹œì‘ ì‹œ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¸ì‹ëœ í…ìŠ¤íŠ¸ë¥¼ í‘œì‹œí•´ì•¼ í•œë‹¤
2. ìŒì„± ì¸ì‹ ì¤‘ê°„ ê²°ê³¼(interim results)ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³´ì—¬ì¤˜ì•¼ í•œë‹¤
3. ìŒì„± ì¸ì‹ì´ ì™„ë£Œë˜ë©´ ìµœì¢… í…ìŠ¤íŠ¸ë¥¼ ë…¸íŠ¸ ì…ë ¥ í•„ë“œì— ìë™ìœ¼ë¡œ ì‚½ì…í•´ì•¼ í•œë‹¤
4. ìŒì„± ì¸ì‹ ì¤‘ì—ëŠ” ì‹œê°ì  í”¼ë“œë°±ì„ ì œê³µí•´ì•¼ í•œë‹¤ (ìƒíƒœ í‘œì‹œ)
5. ìŒì„± ì¸ì‹ ì˜¤ë¥˜ ì‹œ ì‚¬ìš©ìì—ê²Œ ì ì ˆí•œ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•´ì•¼ í•œë‹¤
6. ìŒì„± ì¸ì‹ ê²°ê³¼ì˜ ì •í™•ë„ë¥¼ ë†’ì´ê¸° ìœ„í•œ í›„ì²˜ë¦¬ ê¸°ëŠ¥ì´ ìˆì–´ì•¼ í•œë‹¤
7. ìŒì„± ì¸ì‹ ì¤‘ì— ì‚¬ìš©ìê°€ ì¤‘ë‹¨í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤
8. ìŒì„± ì¸ì‹ ê²°ê³¼ë¥¼ í¸ì§‘í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤
9. ëª¨ë“  ê¸°ëŠ¥ì— ëŒ€í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤

---

## Tasks / Subtasks

- [ ] Task 1: ì‹¤ì‹œê°„ ìŒì„± ì¸ì‹ ì—”ì§„ êµ¬í˜„ (AC: 1, 2, 6)
  - [ ] `lib/speech/voice-recognition.ts` íŒŒì¼ ìƒì„±
  - [ ] SpeechRecognition ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ êµ¬í˜„
  - [ ] ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
  - [ ] ì¤‘ê°„ ê²°ê³¼ì™€ ìµœì¢… ê²°ê³¼ êµ¬ë¶„ ì²˜ë¦¬
  - [ ] í…ìŠ¤íŠ¸ í›„ì²˜ë¦¬ ë° ì •í™•ë„ ê°œì„ 
  - [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±

- [ ] Task 2: ìŒì„± ì¸ì‹ UI ì»´í¬ë„ŒíŠ¸ êµ¬í˜„ (AC: 3, 4, 7)
  - [ ] `components/speech/voice-recognition.tsx` ì»´í¬ë„ŒíŠ¸ ìƒì„±
  - [ ] ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ í‘œì‹œ ì˜ì—­
  - [ ] ìŒì„± ì¸ì‹ ìƒíƒœ ì‹œê°ì  í”¼ë“œë°±
  - [ ] ì‹œì‘/ì¤‘ì§€/ì¤‘ë‹¨ ì»¨íŠ¸ë¡¤ ë²„íŠ¼
  - [ ] ì¸ì‹ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°
  - [ ] ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸ ì‘ì„±

- [ ] Task 3: ìŒì„± ì¸ì‹ ê²°ê³¼ í¸ì§‘ ê¸°ëŠ¥ (AC: 8)
  - [ ] ìŒì„± ì¸ì‹ ê²°ê³¼ í¸ì§‘ ëª¨ë“œ êµ¬í˜„
  - [ ] í…ìŠ¤íŠ¸ ìˆ˜ì • ë° ë³´ì™„ ê¸°ëŠ¥
  - [ ] í¸ì§‘ ì™„ë£Œ í›„ ë…¸íŠ¸ì— ì‚½ì…
  - [ ] í¸ì§‘ ì·¨ì†Œ ê¸°ëŠ¥
  - [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±

- [ ] Task 4: ì—ëŸ¬ í•¸ë“¤ë§ ë° ì‚¬ìš©ì í”¼ë“œë°± (AC: 5)
  - [ ] ìŒì„± ì¸ì‹ ì—ëŸ¬ ìƒí™© ì²˜ë¦¬
  - [ ] ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œ ì²˜ë¦¬
  - [ ] ë§ˆì´í¬ ì ‘ê·¼ ë¬¸ì œ ì²˜ë¦¬
  - [ ] ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€
  - [ ] ì—ëŸ¬ ë³µêµ¬ ê°€ì´ë“œ ì œê³µ
  - [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±

- [ ] Task 5: ë…¸íŠ¸ ì‘ì„± í¼ê³¼ í†µí•© (AC: 3, 8)
  - [ ] `app/notes/new/form.tsx` ìˆ˜ì •
  - [ ] ìŒì„± ì¸ì‹ ê²°ê³¼ë¥¼ ë…¸íŠ¸ ë³¸ë¬¸ì— ì‚½ì…
  - [ ] ê¸°ì¡´ í…ìŠ¤íŠ¸ì™€ ìŒì„± í…ìŠ¤íŠ¸ ë³‘í•©
  - [ ] ì»¤ì„œ ìœ„ì¹˜ ê¸°ë°˜ í…ìŠ¤íŠ¸ ì‚½ì…
  - [ ] í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±

- [ ] Task 6: í†µí•© í…ŒìŠ¤íŠ¸ ë° ì‚¬ìš©ì„± ê²€ì¦ (AC: 9)
  - [ ] ì „ì²´ ìŒì„± ì¸ì‹ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
  - [ ] ë‹¤ì–‘í•œ ìŒì„± í’ˆì§ˆ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
  - [ ] ì—ëŸ¬ ìƒí™© ì‹œë®¬ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸
  - [ ] ì‚¬ìš©ì ê²½í—˜ í”Œë¡œìš° í…ŒìŠ¤íŠ¸

---

## Dev Notes

### ê¸°ìˆ  ìŠ¤íƒ ë° ì•„í‚¤í…ì²˜ ì»¨í…ìŠ¤íŠ¸

**Web Speech API**
- SpeechRecognition API ì‚¬ìš©
- ì‹¤ì‹œê°„ ìŒì„±-í…ìŠ¤íŠ¸ ë³€í™˜
- interimResults: trueë¡œ ì¤‘ê°„ ê²°ê³¼ í‘œì‹œ
- continuous: trueë¡œ ì—°ì† ì¸ì‹
- í•œêµ­ì–´(ko-KR) ì–¸ì–´ ì„¤ì •
[Source: docs/epics/epic-3-voice-memo.md]

**ìŒì„± ì¸ì‹ ì´ë²¤íŠ¸**
- onstart: ìŒì„± ì¸ì‹ ì‹œì‘
- onresult: ì¸ì‹ ê²°ê³¼ ìˆ˜ì‹ 
- onerror: ì¸ì‹ ì—ëŸ¬ ë°œìƒ
- onend: ìŒì„± ì¸ì‹ ì¢…ë£Œ
- ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
[Source: Web Speech API ë¬¸ì„œ]

**React ìƒíƒœ ê´€ë¦¬**
- useStateë¡œ ìŒì„± ì¸ì‹ ìƒíƒœ ê´€ë¦¬
- useEffectë¡œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ê´€ë¦¬
- ì‹¤ì‹œê°„ UI ì—…ë°ì´íŠ¸
- ì‚¬ìš©ì ê²½í—˜ ìµœì í™”
[Source: React ê³µì‹ ë¬¸ì„œ íŒ¨í„´]

### Epic ì»¨í…ìŠ¤íŠ¸

**Epic 3: ìŒì„±ì¸ì‹ ë©”ëª¨ ì‘ì„±**
- ìŒì„±ì¸ì‹ ì •í™•ë„ 95% ì´ìƒ ëª©í‘œ
- ìŒì„±-í…ìŠ¤íŠ¸ ë³€í™˜ ì§€ì—°ì‹œê°„ 2ì´ˆ ì´ë‚´
- ì‹¤ì‹œê°„ ìŒì„±-í…ìŠ¤íŠ¸ ë³€í™˜ìœ¼ë¡œ ì¦‰ì‹œ í™•ì¸ ê°€ëŠ¥
- ë¹ ë¥´ê³  í¸ë¦¬í•œ ìŒì„± ê¸°ë°˜ ë©”ëª¨ ì‘ì„± ê²½í—˜
[Source: docs/epics/epic-3-voice-memo.md]

### ì´ì „ ìŠ¤í† ë¦¬ì—ì„œì˜ ì£¼ìš” ì¸ì‚¬ì´íŠ¸

**Story 3.1: ìŒì„±ì¸ì‹ ì‹œìŠ¤í…œ ì´ˆê¸° ì„¤ì • ì™„ë£Œ**
- `lib/speech/speech-recognition.ts`: SpeechRecognition ì´ˆê¸°í™”
- `lib/speech/permission-manager.ts`: ê¶Œí•œ ìƒíƒœ ê´€ë¦¬
- `lib/speech/speech-utils.ts`: ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ê²€ì‚¬
- í•œêµ­ì–´ ì„¤ì • ë° ì—ëŸ¬ í•¸ë“¤ë§ íŒ¨í„´
[Source: docs/stories/3.1.story.md]

**Story 2.x: ë…¸íŠ¸ ê´€ë¦¬ íŒ¨í„´**
- `app/notes/new/form.tsx`: ë…¸íŠ¸ ì‘ì„± í¼ êµ¬ì¡°
- shadcn/ui ì»´í¬ë„ŒíŠ¸ í™œìš©
- Server Actions íŒ¨í„´
- ì‚¬ìš©ì ê²½í—˜ ì¤‘ì‹¬ì˜ UI ì„¤ê³„
[Source: app/notes/actions.ts, lib/db/notes.ts]

### íŒŒì¼ ìœ„ì¹˜ ë° êµ¬ì¡°

**ìƒˆë¡œ ìƒì„±í•  íŒŒì¼:**
- `lib/speech/voice-recognition.ts` - ì‹¤ì‹œê°„ ìŒì„± ì¸ì‹ ì—”ì§„
- `components/speech/voice-recognition.tsx` - ìŒì„± ì¸ì‹ UI ì»´í¬ë„ŒíŠ¸
- `lib/speech/voice-recognition.test.ts` - ìŒì„± ì¸ì‹ ì—”ì§„ í…ŒìŠ¤íŠ¸
- `components/speech/voice-recognition.test.tsx` - ìŒì„± ì¸ì‹ UI í…ŒìŠ¤íŠ¸

**ìˆ˜ì •í•  íŒŒì¼:**
- `app/notes/new/form.tsx` - ìŒì„± ì¸ì‹ ê¸°ëŠ¥ í†µí•©

### êµ¬í˜„ ê°€ì´ë“œë¼ì¸

**ì‹¤ì‹œê°„ ìŒì„± ì¸ì‹ ì—”ì§„ ì˜ˆì‹œ:**

```typescript
// lib/speech/voice-recognition.ts
// ì‹¤ì‹œê°„ ìŒì„±-í…ìŠ¤íŠ¸ ë³€í™˜ ì—”ì§„
// SpeechRecognition ì´ë²¤íŠ¸ ì²˜ë¦¬ ë° í…ìŠ¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°
// ê´€ë ¨ íŒŒì¼: components/speech/voice-recognition.tsx, app/notes/new/form.tsx

import { SpeechRecognitionManager } from './speech-recognition';

export type RecognitionState = 'idle' | 'listening' | 'processing' | 'error';
export type RecognitionResult = {
  interim: string;
  final: string;
  confidence: number;
};

export interface VoiceRecognitionCallbacks {
  onStart?: () => void;
  onResult?: (result: RecognitionResult) => void;
  onError?: (error: string) => void;
  onEnd?: () => void;
  onStateChange?: (state: RecognitionState) => void;
}

export class VoiceRecognitionEngine {
  private speechManager: SpeechRecognitionManager;
  private recognition: SpeechRecognition | webkitSpeechRecognition | null = null;
  private state: RecognitionState = 'idle';
  private callbacks: VoiceRecognitionCallbacks = {};
  private interimTranscript = '';
  private finalTranscript = '';

  constructor() {
    this.speechManager = new SpeechRecognitionManager();
  }

  /**
   * ìŒì„± ì¸ì‹ ì—”ì§„ ì´ˆê¸°í™”
   */
  async initialize(): Promise<void> {
    await this.speechManager.initialize();
    this.recognition = this.speechManager.getRecognition();
    
    if (!this.recognition) {
      throw new Error('SpeechRecognitionì„ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }

    this.setupEventListeners();
  }

  /**
   * ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
   */
  private setupEventListeners(): void {
    if (!this.recognition) return;

    this.recognition.onstart = () => {
      this.setState('listening');
      this.callbacks.onStart?.();
    };

    this.recognition.onresult = (event) => {
      this.handleRecognitionResult(event);
    };

    this.recognition.onerror = (event) => {
      this.handleRecognitionError(event);
    };

    this.recognition.onend = () => {
      this.setState('idle');
      this.callbacks.onEnd?.();
    };
  }

  /**
   * ìŒì„± ì¸ì‹ ê²°ê³¼ ì²˜ë¦¬
   */
  private handleRecognitionResult(event: SpeechRecognitionEvent): void {
    this.interimTranscript = '';
    this.finalTranscript = '';

    for (let i = event.resultIndex; i < event.results.length; i++) {
      const result = event.results[i];
      const transcript = result[0].transcript;
      const confidence = result[0].confidence;

      if (result.isFinal) {
        this.finalTranscript += transcript;
      } else {
        this.interimTranscript += transcript;
      }
    }

    // í›„ì²˜ë¦¬ ì ìš©
    const processedInterim = this.postProcessText(this.interimTranscript);
    const processedFinal = this.postProcessText(this.finalTranscript);

    this.callbacks.onResult?.({
      interim: processedInterim,
      final: processedFinal,
      confidence: event.results[event.results.length - 1]?.[0]?.confidence || 0,
    });
  }

  /**
   * ìŒì„± ì¸ì‹ ì—ëŸ¬ ì²˜ë¦¬
   */
  private handleRecognitionError(event: SpeechRecognitionErrorEvent): void {
    this.setState('error');
    
    let errorMessage = 'ìŒì„± ì¸ì‹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
    
    switch (event.error) {
      case 'no-speech':
        errorMessage = 'ìŒì„±ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
        break;
      case 'audio-capture':
        errorMessage = 'ë§ˆì´í¬ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§ˆì´í¬ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
        break;
      case 'not-allowed':
        errorMessage = 'ë§ˆì´í¬ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.';
        break;
      case 'network':
        errorMessage = 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
        break;
      case 'aborted':
        errorMessage = 'ìŒì„± ì¸ì‹ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.';
        break;
      case 'language-not-supported':
        errorMessage = 'ì§€ì›í•˜ì§€ ì•ŠëŠ” ì–¸ì–´ì…ë‹ˆë‹¤.';
        break;
    }

    this.callbacks.onError?.(errorMessage);
  }

  /**
   * í…ìŠ¤íŠ¸ í›„ì²˜ë¦¬ (ì •í™•ë„ ê°œì„ )
   */
  private postProcessText(text: string): string {
    return text
      .trim()
      .replace(/\s+/g, ' ') // ì—°ì† ê³µë°± ì œê±°
      .replace(/[^\w\sê°€-í£.,!?]/g, '') // íŠ¹ìˆ˜ë¬¸ì ì •ë¦¬
      .replace(/([.!?])\s*([a-zA-Zê°€-í£])/g, '$1 $2'); // ë¬¸ì¥ ë¶€í˜¸ í›„ ê³µë°± ì •ë¦¬
  }

  /**
   * ìŒì„± ì¸ì‹ ì‹œì‘
   */
  start(): void {
    if (!this.recognition || this.state === 'listening') {
      return;
    }

    this.interimTranscript = '';
    this.finalTranscript = '';
    this.recognition.start();
  }

  /**
   * ìŒì„± ì¸ì‹ ì¤‘ì§€
   */
  stop(): void {
    if (!this.recognition || this.state !== 'listening') {
      return;
    }

    this.recognition.stop();
  }

  /**
   * ìŒì„± ì¸ì‹ ì¤‘ë‹¨
   */
  abort(): void {
    if (!this.recognition) {
      return;
    }

    this.recognition.abort();
    this.setState('idle');
  }

  /**
   * ìƒíƒœ ì„¤ì • ë° ì½œë°± í˜¸ì¶œ
   */
  private setState(newState: RecognitionState): void {
    if (this.state !== newState) {
      this.state = newState;
      this.callbacks.onStateChange?.(newState);
    }
  }

  /**
   * í˜„ì¬ ìƒíƒœ ë°˜í™˜
   */
  getState(): RecognitionState {
    return this.state;
  }

  /**
   * ì½œë°± í•¨ìˆ˜ ì„¤ì •
   */
  setCallbacks(callbacks: VoiceRecognitionCallbacks): void {
    this.callbacks = { ...this.callbacks, ...callbacks };
  }

  /**
   * ë¦¬ì†ŒìŠ¤ ì •ë¦¬
   */
  destroy(): void {
    if (this.recognition) {
      this.recognition.abort();
    }
    this.callbacks = {};
  }
}
```

**ìŒì„± ì¸ì‹ UI ì»´í¬ë„ŒíŠ¸ ì˜ˆì‹œ:**

```typescript
// components/speech/voice-recognition.tsx
// ì‹¤ì‹œê°„ ìŒì„± ì¸ì‹ UI ì»´í¬ë„ŒíŠ¸
// ìŒì„± ì¸ì‹ ìƒíƒœ í‘œì‹œ ë° ì»¨íŠ¸ë¡¤
// ê´€ë ¨ íŒŒì¼: lib/speech/voice-recognition.ts, app/notes/new/form.tsx

'use client';

import { useEffect, useState, useRef } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { VoiceRecognitionEngine, type RecognitionState, type RecognitionResult } from '@/lib/speech/voice-recognition';

interface VoiceRecognitionProps {
  onTextRecognized: (text: string) => void;
  onError: (error: string) => void;
}

export function VoiceRecognition({ onTextRecognized, onError }: VoiceRecognitionProps) {
  const [state, setState] = useState<RecognitionState>('idle');
  const [interimText, setInterimText] = useState('');
  const [finalText, setFinalText] = useState('');
  const [confidence, setConfidence] = useState(0);
  const [isInitialized, setIsInitialized] = useState(false);
  const engineRef = useRef<VoiceRecognitionEngine | null>(null);

  useEffect(() => {
    const initializeEngine = async () => {
      try {
        const engine = new VoiceRecognitionEngine();
        await engine.initialize();
        
        engine.setCallbacks({
          onStart: () => {
            setInterimText('');
            setFinalText('');
            setConfidence(0);
          },
          onResult: (result: RecognitionResult) => {
            setInterimText(result.interim);
            setFinalText(result.final);
            setConfidence(result.confidence);
            
            // ìµœì¢… ê²°ê³¼ê°€ ìˆìœ¼ë©´ ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì— ì „ë‹¬
            if (result.final) {
              onTextRecognized(result.final);
            }
          },
          onError: (error: string) => {
            onError(error);
          },
          onStateChange: (newState: RecognitionState) => {
            setState(newState);
          },
        });

        engineRef.current = engine;
        setIsInitialized(true);
      } catch (error) {
        onError('ìŒì„± ì¸ì‹ ì—”ì§„ì„ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
    };

    initializeEngine();

    return () => {
      if (engineRef.current) {
        engineRef.current.destroy();
      }
    };
  }, [onTextRecognized, onError]);

  const handleStart = () => {
    if (engineRef.current && state === 'idle') {
      engineRef.current.start();
    }
  };

  const handleStop = () => {
    if (engineRef.current && state === 'listening') {
      engineRef.current.stop();
    }
  };

  const handleAbort = () => {
    if (engineRef.current) {
      engineRef.current.abort();
    }
  };

  const renderRecognitionStatus = () => {
    switch (state) {
      case 'idle':
        return (
          <div className="flex items-center space-x-2">
            <div className="w-3 h-3 bg-gray-400 rounded-full"></div>
            <span className="text-gray-600">ìŒì„± ì¸ì‹ ëŒ€ê¸° ì¤‘</span>
          </div>
        );
      case 'listening':
        return (
          <div className="flex items-center space-x-2">
            <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
            <span className="text-green-600">ìŒì„± ì¸ì‹ ì¤‘...</span>
          </div>
        );
      case 'processing':
        return (
          <div className="flex items-center space-x-2">
            <div className="w-3 h-3 bg-blue-500 rounded-full animate-spin"></div>
            <span className="text-blue-600">ì²˜ë¦¬ ì¤‘...</span>
          </div>
        );
      case 'error':
        return (
          <div className="flex items-center space-x-2">
            <div className="w-3 h-3 bg-red-500 rounded-full"></div>
            <span className="text-red-600">ì˜¤ë¥˜ ë°œìƒ</span>
          </div>
        );
    }
  };

  if (!isInitialized) {
    return (
      <Card>
        <CardContent className="p-4">
          <p className="text-gray-600">ìŒì„± ì¸ì‹ ì—”ì§„ì„ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘...</p>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          <span>ìŒì„± ì¸ì‹</span>
          {renderRecognitionStatus()}
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* ì¸ì‹ ê²°ê³¼ í‘œì‹œ */}
        <div className="space-y-2">
          {finalText && (
            <div className="p-3 bg-green-50 border border-green-200 rounded-md">
              <p className="text-green-800 text-sm font-medium">ìµœì¢… ê²°ê³¼:</p>
              <p className="text-green-700">{finalText}</p>
              {confidence > 0 && (
                <p className="text-green-600 text-xs mt-1">
                  ì‹ ë¢°ë„: {Math.round(confidence * 100)}%
                </p>
              )}
            </div>
          )}
          
          {interimText && (
            <div className="p-3 bg-blue-50 border border-blue-200 rounded-md">
              <p className="text-blue-800 text-sm font-medium">ì¸ì‹ ì¤‘:</p>
              <p className="text-blue-700 italic">{interimText}</p>
            </div>
          )}
        </div>

        {/* ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */}
        <div className="flex space-x-2">
          {state === 'idle' && (
            <Button onClick={handleStart} className="flex-1">
              ğŸ¤ ìŒì„± ì¸ì‹ ì‹œì‘
            </Button>
          )}
          
          {state === 'listening' && (
            <>
              <Button onClick={handleStop} variant="outline" className="flex-1">
                â¹ï¸ ì¤‘ì§€
              </Button>
              <Button onClick={handleAbort} variant="destructive" className="flex-1">
                âŒ ì¤‘ë‹¨
              </Button>
            </>
          )}
        </div>

        {/* ì‚¬ìš© ì•ˆë‚´ */}
        <div className="text-xs text-gray-500 space-y-1">
          <p>â€¢ ë§ˆì´í¬ì— ê°€ê¹Œì´ì„œ ëª…í™•í•˜ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”</p>
          <p>â€¢ ì¡°ìš©í•œ í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ë©´ ì¸ì‹ë¥ ì´ ë†’ì•„ì§‘ë‹ˆë‹¤</p>
          <p>â€¢ ì¸ì‹ì´ ì™„ë£Œë˜ë©´ ìë™ìœ¼ë¡œ ë…¸íŠ¸ì— ì¶”ê°€ë©ë‹ˆë‹¤</p>
        </div>
      </CardContent>
    </Card>
  );
}
```

### ì˜ì¡´ì„±

**ì„ í–‰ ìŠ¤í† ë¦¬:**
- Story 3.1: ìŒì„±ì¸ì‹ ì‹œìŠ¤í…œ ì´ˆê¸° ì„¤ì • (ì™„ë£Œ)

**í›„ì† ìŠ¤í† ë¦¬:**
- Story 3.3: ìŒì„±ì¸ì‹ ê³ ê¸‰ ê¸°ëŠ¥ ë° ìµœì í™”

**ë¸”ë¡œí‚¹ ì—†ìŒ:**
- ì´ ìŠ¤í† ë¦¬ëŠ” ë…ë¦½ì ìœ¼ë¡œ êµ¬í˜„ ê°€ëŠ¥
- Web Speech APIì™€ ê¶Œí•œ ê´€ë¦¬ê°€ ì™„ë£Œë¨

### Testing

**í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬:**
- Vitest + TypeScript
- jsdom í™˜ê²½ì—ì„œ ë¸Œë¼ìš°ì € API ëª¨í‚¹

**ë‹¨ìœ„ í…ŒìŠ¤íŠ¸:**
- `VoiceRecognitionEngine` í´ë˜ìŠ¤ í…ŒìŠ¤íŠ¸
  - ì´ˆê¸°í™” ì„±ê³µ/ì‹¤íŒ¨ í™•ì¸
  - ìŒì„± ì¸ì‹ ì‹œì‘/ì¤‘ì§€/ì¤‘ë‹¨ í™•ì¸
  - ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë™ì‘ í™•ì¸
  - í…ìŠ¤íŠ¸ í›„ì²˜ë¦¬ í™•ì¸
- ìŒì„± ì¸ì‹ ê²°ê³¼ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
  - ì¤‘ê°„ ê²°ê³¼ì™€ ìµœì¢… ê²°ê³¼ êµ¬ë¶„
  - ì‹ ë¢°ë„ ê³„ì‚° í™•ì¸
  - ì—ëŸ¬ ìƒí™© ì²˜ë¦¬ í™•ì¸

**í†µí•© í…ŒìŠ¤íŠ¸:**
- ìŒì„± ì¸ì‹ UI í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
- ì—ëŸ¬ ìƒí™© UI í‘œì‹œ í…ŒìŠ¤íŠ¸

**ëª¨í‚¹ ì „ëµ:**
- `SpeechRecognition` ì´ë²¤íŠ¸ ëª¨í‚¹
- `SpeechRecognitionEvent` ê²°ê³¼ ëª¨í‚¹
- `SpeechRecognitionErrorEvent` ì—ëŸ¬ ëª¨í‚¹
- ë§ˆì´í¬ ê¶Œí•œ ìƒíƒœ ëª¨í‚¹

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤:**
1. **ìŒì„± ì¸ì‹ ì—”ì§„**
   - ì •ìƒ ì´ˆê¸°í™”
   - ìŒì„± ì¸ì‹ ì‹œì‘/ì¤‘ì§€/ì¤‘ë‹¨
   - ì¸ì‹ ê²°ê³¼ ì²˜ë¦¬
   - ì—ëŸ¬ ìƒí™© ì²˜ë¦¬

2. **ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ ì²˜ë¦¬**
   - ì¤‘ê°„ ê²°ê³¼ í‘œì‹œ
   - ìµœì¢… ê²°ê³¼ í‘œì‹œ
   - í…ìŠ¤íŠ¸ í›„ì²˜ë¦¬
   - ì‹ ë¢°ë„ ê³„ì‚°

3. **UI ì»´í¬ë„ŒíŠ¸**
   - ìƒíƒœë³„ UI í‘œì‹œ
   - ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ë™ì‘
   - ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ

4. **í†µí•© í”Œë¡œìš°**
   - ìŒì„± ì¸ì‹ â†’ í…ìŠ¤íŠ¸ ë³€í™˜ â†’ ë…¸íŠ¸ ì‚½ì…
   - ì—ëŸ¬ ë°œìƒ â†’ ì‚¬ìš©ì ì•ˆë‚´ â†’ ë³µêµ¬
   - ê¶Œí•œ ë¬¸ì œ â†’ ëŒ€ì²´ ë°©ì•ˆ ì œì‹œ

**í…ŒìŠ¤íŠ¸ ì‹¤í–‰:**
- `pnpm test` - ì „ì²´ í…ŒìŠ¤íŠ¸ suite ì‹¤í–‰
- `pnpm test lib/speech/voice-recognition` - ìŒì„± ì¸ì‹ ì—”ì§„ í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰
- `pnpm test components/speech/voice-recognition` - ìŒì„± ì¸ì‹ UI í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Story 3.2 í†µí•© ë²„ì „ ìƒì„± | Bob (Scrum Master) |

---

## Dev Agent Record

_[Dev Agentê°€ êµ¬í˜„ ì‹œ ì‘ì„±]_

---

## QA Results

_[QA Agentê°€ ì‘ì„±]_
