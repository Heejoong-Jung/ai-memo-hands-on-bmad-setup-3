# Story 4.2: 노트 내용 기반 자동 요약 생성

## Status

Done

---

## Story

**As a** 사용자,  
**I want** 노트 작성 후 자동으로 3-6개 불릿 포인트로 요약된 내용을 받아볼 수 있어,  
**so that** 긴 노트의 핵심 내용을 빠르게 파악하고 나중에 쉽게 참조할 수 있다.

---

## Acceptance Criteria

1. 노트 생성 또는 수정 후, "AI 요약 생성" 버튼을 통해 요약을 요청할 수 있어야 한다
2. 요약은 Gemini API를 사용하여 3-6개의 불릿 포인트 형태로 생성되어야 한다
3. 요약 생성 중에는 로딩 상태를 사용자에게 표시해야 한다
4. 생성된 요약은 노트 상세 페이지에 표시되어야 한다
5. 요약은 데이터베이스의 `summaries` 테이블에 저장되어야 한다
6. 노트 내용이 8k 토큰을 초과하는 경우, 토큰 제한 내로 자동 잘라내기가 적용되어야 한다
7. 요약 생성 실패 시, 사용자 친화적인 에러 메시지를 표시해야 한다
8. 이미 요약이 존재하는 경우, 기존 요약을 표시하고 "재생성" 옵션을 제공해야 한다
9. 요약 생성은 서버 사이드에서만 실행되어야 한다 (Server Action)
10. Gemini API 호출 시 적절한 프롬프트를 사용하여 일관된 품질의 요약을 생성해야 한다
11. 모든 기능에 대한 단위 테스트 및 통합 테스트를 작성해야 한다

---

## Tasks / Subtasks

- [x] Task 1: Drizzle 스키마에 `summaries` 테이블 추가 (AC: 5)
  - [x] `drizzle/schema.ts`에 summaries 테이블 정의 추가
  - [x] note_id (FK to notes.id), model (text), content (text), created_at 컬럼 정의
  - [x] note_id에 인덱스 추가
  - [x] TypeScript 타입 추론 (Summary, NewSummary)
  - [x] `pnpm drizzle-kit generate` 실행하여 마이그레이션 파일 생성
  - [x] `pnpm drizzle-kit push` 실행하여 스키마 DB에 반영

- [x] Task 2: Summaries CRUD 함수 구현 (AC: 5, 8)
  - [x] `lib/db/summaries.ts` 파일 생성
  - [x] `createSummary` 함수 구현 (noteId, model, content 저장)
  - [x] `getSummaryByNoteId` 함수 구현 (noteId로 최신 요약 조회)
  - [x] `deleteSummaryByNoteId` 함수 구현 (재생성 시 기존 요약 삭제)
  - [x] 사용자 스코프 검증 (noteId의 userId 확인)
  - [x] 단위 테스트 작성 (`lib/db/summaries.test.ts`)

- [x] Task 3: Gemini API 요약 생성 함수 구현 (AC: 2, 6, 10)
  - [x] `lib/ai/gemini.ts`에 `generateSummary` 함수 추가
  - [x] 노트 내용을 입력으로 받아 Gemini API 호출
  - [x] 요약 프롬프트 작성 (3-6개 불릿 포인트, 명확하고 간결한 요약 지시)
  - [x] 토큰 제한 체크 및 텍스트 자르기 적용 (`truncateToTokenLimit` 사용)
  - [x] 에러 핸들링 (RateLimitError, TimeoutError 등)
  - [x] 단위 테스트 작성 (모킹 활용, `lib/ai/gemini.test.ts` 확장)

- [x] Task 4: AI 요약 생성 Server Action 구현 (AC: 1, 3, 7, 9)
  - [x] `app/notes/actions.ts`에 `generateSummaryAction` 함수 추가
  - [x] 사용자 인증 확인
  - [x] noteId 파라미터 받아 노트 권한 확인
  - [x] 기존 요약 존재 여부 확인 (재생성 시 삭제)
  - [x] `generateSummary` 함수 호출하여 요약 생성
  - [x] `createSummary` 함수 호출하여 DB에 저장
  - [x] 성공/실패 응답 반환 (에러 메시지 포함)
  - [x] 단위 테스트 작성 (`app/notes/actions.test.ts` 확장)

- [x] Task 5: 노트 상세 페이지에 요약 표시 UI 추가 (AC: 4, 8)
  - [x] `app/notes/[id]/page.tsx` 수정
  - [x] `getSummaryByNoteId` 호출하여 요약 데이터 가져오기
  - [x] 요약이 있으면 카드 형태로 표시
  - [x] 요약이 없으면 "AI 요약 생성" 버튼 표시
  - [x] 요약이 있으면 "재생성" 버튼 표시
  - [x] 간결하고 깔끔한 UI 디자인 (shadcn/ui 컴포넌트 활용)

- [x] Task 6: AI 요약 생성 버튼 및 로딩 상태 구현 (AC: 1, 3)
  - [x] `app/notes/[id]/summary-button.tsx` 컴포넌트 생성
  - [x] "AI 요약 생성" 버튼 (요약 없을 때)
  - [x] "재생성" 버튼 (요약 있을 때)
  - [x] `generateSummaryAction` 호출
  - [x] 로딩 상태 관리 (useTransition)
  - [x] 로딩 중 "생성 중..." 메시지 표시
  - [x] 성공 시 페이지 새로고침 (router.refresh)
  - [x] 실패 시 에러 메시지 표시

- [x] Task 7: 통합 테스트 및 엔드투엔드 테스트 (AC: 11)
  - [x] 요약 생성 플로우 전체 테스트
  - [x] 노트 작성 → 요약 생성 → DB 저장 → UI 표시
  - [x] 토큰 제한 초과 시나리오 테스트
  - [x] 에러 핸들링 시나리오 테스트
  - [x] 재생성 시나리오 테스트
  - [x] 페이지 테스트 작성 (`app/notes/[id]/page.test.tsx` 확장)

---

## Dev Notes

### 기술 스택 및 아키텍처 컨텍스트

**데이터 모델**
- `summaries` 테이블: note_id (FK), model (text), content (text), created_at (timestamp)
- 1:N 관계 (notes → summaries), 최신 요약만 표시
[Source: docs/architecture.md#2-데이터-모델]

**AI 모델**
- Google Gemini API 사용 (gemini-2.0-flash)
- 무료 할당량 활용 (분당 15 요청, 일일 1,500 요청)
- 토큰 제한: 8k 토큰
[Source: docs/architecture.md#1-기술-스택]

**서버 액션**
- `regenerateAI` – Gemini 호출 후 요약/태그 저장
- Server Actions로 구현 ('use server' 지시자)
[Source: docs/architecture.md#4-서버-액션]

**보안**
- Summaries: 사용자 스코프 읽기, 삽입/갱신은 서버에서 처리
- noteId의 userId 확인하여 권한 검증
[Source: docs/architecture.md#3-보안]

**성능 가드레일**
- 요약 길이 제한 (8k 토큰)
- Gemini 무료 할당 활용
- 토큰 초과 시 텍스트 자르기
[Source: docs/architecture.md#6-배포운영]

### Epic 컨텍스트

**Epic 4: AI 기반 요약 및 태깅**
- 3-6개 불릿 포인트 요약
- AI 처리 시간 10초 이내
- 에러 핸들링 및 재시도 로직
- 요약 정확도 90% 이상 (사용자 만족도 기준)
[Source: docs/epics/epic-4-ai-summarization-tagging.md]

**PRD 요구사항**
- AI 자동 요약 (3~6 불릿 요약)
- 메모 검색 정확도 90% 이상
[Source: docs/prd.md#3-proposed-solution, docs/prd.md#5-goals--metrics]

### 이전 스토리에서의 주요 인사이트

**Story 4.1: Gemini API 설정 완료**
- `lib/ai/gemini.ts`: Gemini API 클라이언트 및 `generateText` 함수 구현
- `lib/ai/token-utils.ts`: `estimateTokenCount`, `truncateToTokenLimit` 함수 구현
- `lib/ai/types.ts`: 에러 타입 정의 (InvalidApiKeyError, RateLimitError, TimeoutError)
- Lazy 초기화 패턴 적용으로 환경 변수 로딩 문제 해결
- Exponential backoff 재시도 로직 구현
[Source: docs/stories/4.1.story.md]

**Story 2.x: 노트 관리 패턴**
- `app/notes/actions.ts`: Server Actions 패턴 (createNoteAction, updateNoteAction 등)
- `lib/db/notes.ts`: CRUD 함수 패턴 (createNote, getNoteById, updateNote 등)
- 사용자 인증 확인: `supabase.auth.getUser()`
- 사용자 스코프 검증: `and(eq(notes.id, noteId), eq(notes.userId, userId))`
- 에러 핸들링: try-catch 및 사용자 친화적 에러 메시지
[Source: app/notes/actions.ts, lib/db/notes.ts]

### 파일 위치 및 구조

**새로 생성할 파일:**
- `lib/db/summaries.ts` - Summaries CRUD 함수
- `lib/db/summaries.test.ts` - Summaries 단위 테스트
- `app/notes/[id]/summary-button.tsx` - AI 요약 생성/재생성 버튼 컴포넌트
- `drizzle/migrations/000X_add_summaries_table.sql` - 마이그레이션 파일 (자동 생성)

**수정할 파일:**
- `drizzle/schema.ts` - summaries 테이블 추가
- `lib/ai/gemini.ts` - `generateSummary` 함수 추가
- `lib/ai/gemini.test.ts` - 요약 생성 테스트 추가
- `app/notes/actions.ts` - `generateSummaryAction` 함수 추가
- `app/notes/actions.test.ts` - 요약 생성 액션 테스트 추가
- `app/notes/[id]/page.tsx` - 요약 표시 UI 추가
- `app/notes/[id]/page.test.tsx` - 페이지 테스트 확장

### 구현 가이드라인

**Summaries 스키마 예시:**

```typescript
// drizzle/schema.ts 추가 부분
export const summaries = pgTable(
  'summaries',
  {
    id: uuid('id').primaryKey().defaultRandom(),
    noteId: uuid('note_id').notNull().references(() => notes.id, { onDelete: 'cascade' }),
    model: text('model').notNull(), // 예: 'gemini-2.0-flash'
    content: text('content').notNull(), // 불릿 포인트 요약 (마크다운 형식)
    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow().notNull(),
  },
  (table) => ({
    noteIdIdx: index('summaries_note_id_idx').on(table.noteId),
  })
);

export type Summary = typeof summaries.$inferSelect;
export type NewSummary = typeof summaries.$inferInsert;
```

**Summaries CRUD 함수 예시:**

```typescript
// lib/db/summaries.ts
// Summaries 테이블 CRUD 유틸리티 함수
// 사용자 스코프 기반 권한 제어 적용
// 관련 파일: lib/db/client.ts, drizzle/schema.ts, lib/db/notes.ts

import { db } from './client';
import { summaries, notes, type Summary, type NewSummary } from '@/drizzle/schema';
import { eq, and, desc } from 'drizzle-orm';

/**
 * 새로운 요약 생성
 * @param noteId - 노트 ID
 * @param model - 사용된 AI 모델 이름
 * @param content - 요약 내용
 * @returns 생성된 요약 객체
 */
export async function createSummary(
  noteId: string,
  model: string,
  content: string
): Promise<Summary> {
  const newSummary: NewSummary = {
    noteId,
    model,
    content,
  };

  const result = await db.insert(summaries).values(newSummary).returning();
  return result[0];
}

/**
 * 특정 노트의 최신 요약 조회
 * @param noteId - 노트 ID
 * @param userId - 사용자 ID (권한 확인용)
 * @returns 요약 객체 또는 null
 */
export async function getSummaryByNoteId(
  noteId: string,
  userId: string
): Promise<Summary | null> {
  // noteId의 소유자 확인을 위해 notes 테이블과 조인
  const result = await db
    .select({
      id: summaries.id,
      noteId: summaries.noteId,
      model: summaries.model,
      content: summaries.content,
      createdAt: summaries.createdAt,
    })
    .from(summaries)
    .innerJoin(notes, eq(summaries.noteId, notes.id))
    .where(and(eq(summaries.noteId, noteId), eq(notes.userId, userId)))
    .orderBy(desc(summaries.createdAt))
    .limit(1);

  return result[0] || null;
}

/**
 * 특정 노트의 요약 삭제 (재생성 시 사용)
 * @param noteId - 노트 ID
 * @param userId - 사용자 ID (권한 확인용)
 * @returns 삭제 성공 여부
 */
export async function deleteSummaryByNoteId(
  noteId: string,
  userId: string
): Promise<boolean> {
  // noteId의 소유자 확인
  const note = await db
    .select()
    .from(notes)
    .where(and(eq(notes.id, noteId), eq(notes.userId, userId)))
    .limit(1);

  if (note.length === 0) {
    return false; // 권한 없음
  }

  const result = await db
    .delete(summaries)
    .where(eq(summaries.noteId, noteId))
    .returning();

  return result.length > 0;
}
```

**Gemini API 요약 생성 함수 예시:**

```typescript
// lib/ai/gemini.ts 추가 부분
import { truncateToTokenLimit } from './token-utils';

/**
 * 노트 내용을 기반으로 요약 생성
 * @param noteContent - 노트 내용
 * @returns 3-6개 불릿 포인트 요약 (마크다운 형식)
 */
export async function generateSummary(noteContent: string): Promise<string> {
  // 토큰 제한 체크 및 자르기
  const truncatedContent = truncateToTokenLimit(noteContent);

  // 요약 프롬프트
  const prompt = `다음 노트의 핵심 내용을 3-6개의 불릿 포인트로 요약해주세요. 각 불릿 포인트는 명확하고 간결해야 하며, 마크다운 형식(- 또는 *)을 사용하세요.

노트 내용:
${truncatedContent}

요약:`;

  try {
    const summary = await generateText(prompt, 'gemini-2.0-flash');
    return summary.trim();
  } catch (error) {
    console.error('요약 생성 실패:', error);
    throw error;
  }
}
```

**Server Action 예시:**

```typescript
// app/notes/actions.ts 추가 부분
import { generateSummary } from '@/lib/ai/gemini';
import { createSummary, getSummaryByNoteId, deleteSummaryByNoteId } from '@/lib/db/summaries';
import { revalidatePath } from 'next/cache';

/**
 * AI 요약 생성 Server Action
 * @param noteId - 노트 ID
 * @returns 성공 시 생성된 요약, 실패 시 에러 메시지
 */
export async function generateSummaryAction(
  noteId: string
): Promise<{ success?: boolean; summary?: string; error?: string }> {
  const supabase = await createClient();

  // 사용자 인증 확인
  const {
    data: { user },
    error: authError,
  } = await supabase.auth.getUser();

  if (authError || !user) {
    return { error: '로그인이 필요합니다.' };
  }

  try {
    // 노트 권한 확인
    const note = await getNoteById(noteId, user.id);
    if (!note) {
      return { error: '노트를 찾을 수 없거나 권한이 없습니다.' };
    }

    // 기존 요약 삭제 (재생성)
    await deleteSummaryByNoteId(noteId, user.id);

    // Gemini API로 요약 생성
    const summaryContent = await generateSummary(note.content);

    // DB에 요약 저장
    await createSummary(noteId, 'gemini-2.0-flash', summaryContent);

    // 페이지 재검증
    revalidatePath(`/notes/${noteId}`);

    return { success: true, summary: summaryContent };
  } catch (error) {
    console.error('요약 생성 에러:', error);
    
    // 에러 타입에 따른 메시지
    if (error instanceof RateLimitError) {
      return { error: 'API 요청 한도를 초과했습니다. 잠시 후 다시 시도해주세요.' };
    }
    if (error instanceof TimeoutError) {
      return { error: '요청 시간이 초과되었습니다. 다시 시도해주세요.' };
    }
    
    return { error: 'AI 요약 생성 중 오류가 발생했습니다.' };
  }
}
```

**UI 컴포넌트 예시:**

```typescript
// app/notes/[id]/summary-button.tsx
'use client';

import { useState, useTransition } from 'react';
import { Button } from '@/components/ui/button';
import { generateSummaryAction } from '@/app/notes/actions';
import { useRouter } from 'next/navigation';

export function SummaryButton({ noteId, hasSummary }: { noteId: string; hasSummary: boolean }) {
  const [isPending, startTransition] = useTransition();
  const [error, setError] = useState<string | null>(null);
  const router = useRouter();

  const handleGenerate = () => {
    startTransition(async () => {
      setError(null);
      const result = await generateSummaryAction(noteId);
      
      if (result.error) {
        setError(result.error);
      } else {
        router.refresh();
      }
    });
  };

  return (
    <div>
      <Button onClick={handleGenerate} disabled={isPending}>
        {isPending ? '생성 중...' : hasSummary ? '재생성' : 'AI 요약 생성'}
      </Button>
      {error && <p className="text-red-500 text-sm mt-2">{error}</p>}
    </div>
  );
}
```

```typescript
// app/notes/[id]/page.tsx 수정 부분
import { getSummaryByNoteId } from '@/lib/db/summaries';
import { SummaryButton } from './summary-button';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';

// ... 기존 코드

// 요약 조회 추가
const summary = await getSummaryByNoteId(note.id, user.id);

// JSX에 요약 표시
{summary ? (
  <Card>
    <CardHeader>
      <CardTitle>AI 요약</CardTitle>
    </CardHeader>
    <CardContent>
      <div className="prose">
        {summary.content.split('\n').map((line, idx) => (
          <p key={idx}>{line}</p>
        ))}
      </div>
      <SummaryButton noteId={note.id} hasSummary={true} />
    </CardContent>
  </Card>
) : (
  <Card>
    <CardHeader>
      <CardTitle>AI 요약</CardTitle>
    </CardHeader>
    <CardContent>
      <p className="text-muted-foreground mb-4">
        AI가 노트의 핵심 내용을 3-6개의 불릿 포인트로 요약해드립니다.
      </p>
      <SummaryButton noteId={note.id} hasSummary={false} />
    </CardContent>
  </Card>
)}
```

### 의존성

**선행 스토리:**
- Story 4.1: Gemini API 설정 및 연동 (완료)
- Story 2.x: 노트 관리 시스템 (완료)

**후속 스토리:**
- Story 4.3: 노트 내용 기반 자동 태그 생성
- Story 4.4: AI 처리 상태 표시 (로딩, 완료, 에러)

**블로킹 없음:**
- 이 스토리는 독립적으로 구현 가능
- Gemini API와 노트 시스템이 이미 구현됨

### Testing

**테스트 프레임워크:**
- Vitest + TypeScript

**단위 테스트:**
- `createSummary` 함수 테스트
  - 정상 요약 생성 확인
  - 반환 값 검증
- `getSummaryByNoteId` 함수 테스트
  - 정상 조회 확인
  - 권한 없는 경우 null 반환 확인
- `deleteSummaryByNoteId` 함수 테스트
  - 정상 삭제 확인
  - 권한 없는 경우 false 반환 확인
- `generateSummary` 함수 테스트
  - 정상 요약 생성 확인 (모킹)
  - 토큰 제한 초과 시 자르기 확인
  - 에러 핸들링 확인
- `generateSummaryAction` 함수 테스트
  - 정상 플로우 확인
  - 인증 실패 케이스
  - 권한 없는 케이스
  - API 에러 케이스 (RateLimitError, TimeoutError)

**통합 테스트:**
- 노트 작성 → 요약 생성 → DB 저장 → 조회
- 재생성 플로우 (기존 요약 삭제 → 새 요약 생성)
- 페이지 렌더링 (요약 있을 때, 없을 때)

**테스트 케이스:**
1. **Summaries CRUD**
   - 요약 생성 성공
   - 요약 조회 성공
   - 권한 없는 요약 조회 실패
   - 요약 삭제 성공

2. **Gemini API 요약 생성**
   - 짧은 노트 요약 생성 (< 1000자)
   - 긴 노트 요약 생성 (> 10,000자, 토큰 제한 적용)
   - API 에러 핸들링 (RateLimitError, TimeoutError)

3. **Server Action**
   - 인증된 사용자의 요약 생성 성공
   - 미인증 사용자 요약 생성 실패
   - 권한 없는 노트의 요약 생성 실패
   - API 에러 시 사용자 친화적 메시지 반환

4. **UI 컴포넌트**
   - 요약 없을 때 "AI 요약 생성" 버튼 표시
   - 요약 있을 때 요약 내용 및 "재생성" 버튼 표시
   - 로딩 상태 표시
   - 에러 메시지 표시

**테스트 실행:**
- `pnpm test` - 전체 테스트 suite 실행
- `pnpm test lib/db/summaries` - Summaries 테스트만 실행
- `pnpm test lib/ai` - AI 관련 테스트만 실행
- `pnpm test app/notes` - Notes 액션 테스트 실행

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | 스토리 4.2 초안 생성 | Bob (Scrum Master) |
| 2025-10-14 | 2.0 | 노트 내용 기반 자동 요약 생성 기능 구현 완료 - 모든 AC 충족, 19개 신규 테스트 추가, 전체 223개 테스트 통과, 스토리 Done 처리 | James (Developer) |

---

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5

### Debug Log References

- 전체 테스트 결과: 223개 테스트 모두 통과 (14개 테스트 파일)
- Summaries CRUD 테스트: 8개 테스트 통과
- Gemini API 요약 생성 테스트: 16개 테스트 통과 (5개 신규 추가)
- Server Actions 테스트: 46개 테스트 통과 (6개 신규 추가)
- 페이지 테스트: getSummaryByNoteId 모킹 추가하여 4개 실패 테스트 수정 완료

### Completion Notes List

- 모든 Acceptance Criteria 충족:
  - AC 1, 9: "AI 요약 생성" 버튼을 통해 서버 사이드에서 요약 생성
  - AC 2, 10: Gemini API로 3-6개 불릿 포인트 형태의 일관된 품질 요약 생성
  - AC 3: 로딩 상태 표시 (useTransition 사용)
  - AC 4, 8: 노트 상세 페이지에 요약 표시, 재생성 옵션 제공
  - AC 5: summaries 테이블에 저장 (DB 마이그레이션 완료)
  - AC 6: 8k 토큰 제한 자동 적용 (truncateToTokenLimit 사용)
  - AC 7: 사용자 친화적 에러 메시지 (RateLimitError, TimeoutError 등)
  - AC 11: 포괄적인 단위 테스트 및 통합 테스트 작성

- 기술적 구현 세부사항:
  - Drizzle 스키마에 summaries 테이블 추가 (cascade delete 설정)
  - 사용자 스코프 기반 권한 검증 (noteId → userId 확인)
  - Gemini API 요약 생성 함수 (generateSummary)
  - Server Action (generateSummaryAction) 구현
  - React useTransition을 사용한 로딩 상태 관리
  - shadcn/ui Card 컴포넌트를 활용한 깔끔한 UI
  - 재생성 시 기존 요약 삭제 후 새로 생성

- 테스트 커버리지:
  - Summaries CRUD: 8개 테스트 (생성, 조회, 삭제, 권한 검증)
  - Gemini 요약 생성: 5개 신규 테스트 (정상 생성, 토큰 제한, 에러 핸들링)
  - Server Action: 6개 신규 테스트 (인증, 권한, Rate Limit, Timeout 에러)
  - 페이지 UI: getSummaryByNoteId 모킹 추가하여 회귀 테스트 통과

- 추가 작업:
  - app/notes/[id]/page.test.tsx에 getSummaryByNoteId 모킹 추가
  - 기존 페이지 테스트 4개 수정 (DB 연결 에러 해결)
  - 마이그레이션 파일 생성 및 DB 반영 완료

### File List

**신규 생성:**
- `lib/db/summaries.ts` - Summaries CRUD 함수 (createSummary, getSummaryByNoteId, deleteSummaryByNoteId)
- `lib/db/summaries.test.ts` - Summaries 단위 테스트 (8개 테스트)
- `app/notes/[id]/summary-button.tsx` - AI 요약 생성/재생성 버튼 컴포넌트 (클라이언트 컴포넌트)
- `drizzle/migrations/0002_numerous_tarantula.sql` - summaries 테이블 마이그레이션

**수정:**
- `drizzle/schema.ts` - summaries 테이블 추가, Summary/NewSummary 타입 추가
- `lib/ai/gemini.ts` - generateSummary 함수 추가 (요약 프롬프트, 토큰 제한 적용)
- `lib/ai/gemini.test.ts` - generateSummary 테스트 5개 추가 (총 16개 테스트)
- `app/notes/actions.ts` - generateSummaryAction 함수 추가, import 문 추가
- `app/notes/actions.test.ts` - generateSummaryAction 테스트 6개 추가, 모킹 설정 추가 (총 46개 테스트)
- `app/notes/[id]/page.tsx` - 요약 조회, 요약 카드 UI 추가, import 문 추가
- `app/notes/[id]/page.test.tsx` - getSummaryByNoteId 모킹 추가, import 문 추가
- `docs/stories/4.2.story.md` - Status Done, Tasks 체크, Dev Agent Record 업데이트

---

## QA Results

_[QA Agent가 작성]_

